<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Page 3</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>

<body class="container">

<nav class="navbar bg-body-secondary rounded">
  <div class="container-fluid">
    <a class="navbar-brand" href="index.html">Home</a>
  </div>
</nav>

<h2 class="text-center mt-4">Track Popularity by Album Type</h2>

<div class="card mt-3">
  <div class="card-body">
    <canvas id="albumChart"></canvas>
  </div>
</div>

<script>
const canvas = document.getElementById("albumChart");

Papa.parse("filtered_data_Statistics.csv", {
  download: true,
  header: true,
  complete: function(results) {

    const artists = {};

    for (let i = 0; i < results.data.length; i++) {
      const row = results.data[i];
      const name = row.artist_name;
      const followers = Number(row.artist_followers);
      const popularity = Number(row.track_popularity);

      if (!name || isNaN(followers) || isNaN(popularity)) continue;

      if (!artists[name]) {
        artists[name] = { followers: followers, popularity: popularity };
      } else {
        if (followers > artists[name].followers) artists[name].followers = followers;
        if (popularity > artists[name].popularity) artists[name].popularity = popularity;
      }
    }

    const points = [];
    for (const name in artists) {
      points.push({
        x: artists[name].followers,
        y: artists[name].popularity
      });
    }

    new Chart(canvas, {
      type: "scatter",
      data: {
        datasets: [{
          label: "Track popularity",
          data: points,
          pointRadius: 4
        }]
      },
      options: {
        plugins: {
          legend: { display: true }
        },
        scales: {
          x: { title: { display: true, text: "Artist Followers" } },
          y: { title: { display: true, text: "Track popularity" }, suggestedMin: 0, suggestedMax: 120 }
        }
      }
    });

  }
});
</script>

</body>
</html>